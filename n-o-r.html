<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="UTF-8">

<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Memory-Safety-Experimental | Experimenting with ways to increase memory safety in Delphi</title>
<meta name="generator" content="Jekyll v3.9.5" />
<meta property="og:title" content="Memory-Safety-Experimental" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Experimenting with ways to increase memory safety in Delphi" />
<meta property="og:description" content="Experimenting with ways to increase memory safety in Delphi" />
<link rel="canonical" href="https://pmcgee69.github.io/Memory-Safety-Experimental/" />
<meta property="og:url" content="https://pmcgee69.github.io/Memory-Safety-Experimental/" />
<meta property="og:site_name" content="Memory-Safety-Experimental" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Memory-Safety-Experimental" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebSite","description":"Experimenting with ways to increase memory safety in Delphi","headline":"Memory-Safety-Experimental","name":"Memory-Safety-Experimental","url":"https://pmcgee69.github.io/Memory-Safety-Experimental/"}</script>
<!-- End Jekyll SEO tag -->

    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link rel="preload" href="https://fonts.googleapis.com/css?family=Open+Sans:400,700&display=swap" as="style" type="text/css" crossorigin>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#157878">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="stylesheet" href="/Memory-Safety-Experimental/assets/css/style.css?v=4cb711694751d4ce07ac22867f5e1042ed658ff0">
    <!-- start custom head snippets, customize with your own _includes/head-custom.html file -->

<!-- Setup Google Analytics -->



<!-- You can set your favicon here -->
<!-- link rel="shortcut icon" type="image/x-icon" href="/Memory-Safety-Experimental/favicon.ico" -->

<!-- end custom head snippets -->

  </head>
  <body>
    <a id="skip-to-content" href="#content">Skip to the content.</a>

    <header class="page-header" role="banner">
      <h1 class="project-name">Memory-Safety-Experimental</h1>
      <h2 class="project-tagline">Experimenting with ways to increase memory safety in Delphi</h2>
      
        <a href="https://github.com/pmcgee69/Memory-Safety-Experimental" class="btn">View on GitHub</a>
      
      
    </header>

    <main id="content" class="main-content" role="main">
      <h1 id="memory-safety-experimental">Non-Owning References (v1)</h1>

          <p>I asked on our ADUG forum : "Someone please show me a nicer way than
          this to create non-owning method references â€¦"</p>
           <div class="language-pascal highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">{$APPTYPE CONSOLE}</span>
<!--           <div class="sourceCode" id="cb1"><pre -->
<!--           class="sourceCode pascal"><code class="sourceCode pascal"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="ot">{$APPTYPE CONSOLE}</span></span> -->
          <span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="kw">program</span> Project_Non_owning_ref;</span>
          <span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="kw">uses</span></span>
          <span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  system.SysUtils;</span>
          <span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
          <span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> make_non_owning(<span class="kw">const</span> [ref] c:TObject; <span class="kw">const</span> m:Tproc):TProc;</span>
          <span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  <span class="kw">begin</span></span>
          <span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>     <span class="kw">var</span> _c := @c;</span>
          <span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>     result := <span class="kw">procedure</span> <span class="kw">begin</span></span>
          <span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>                            <span class="kw">var</span> x := TObject(<span class="dt">Pointer</span>(_c)^);</span>
          <span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>                            <span class="kw">if</span>  x &lt;&gt; <span class="kw">nil</span> <span class="kw">then</span> m()</span>
          <span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>                                         <span class="kw">else</span> writeln(<span class="st">&#39;dead call&#39;</span>)</span>
          <span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>                         <span class="kw">end</span></span>
          <span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>  <span class="kw">end</span>;</span>
          <span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a></span>
          <span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span></span>
          <span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>  TMyClass = <span class="kw">class</span></span>
          <span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>      field : <span class="dt">integer</span>;</span>
          <span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>      <span class="kw">procedure</span>   <span class="kw">read</span>;</span>
          <span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>      <span class="kw">procedure</span>   incr;</span>
          <span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>      <span class="kw">constructor</span> create;</span>
          <span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>  <span class="kw">end</span>;</span>
          <span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a></span>
          <span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>  <span class="kw">procedure</span>   TMyClass.<span class="kw">read</span>;    <span class="kw">begin</span>   writeln(field);    <span class="kw">end</span>;</span>
          <span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>  <span class="kw">procedure</span>   TMyClass.incr;    <span class="kw">begin</span>   inc(field);        <span class="kw">end</span>;</span>
          <span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>  <span class="kw">constructor</span> TMyClass.create;  <span class="kw">begin</span>   field := <span class="dv">42</span>;       <span class="kw">end</span>;</span>
          <span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a></span>
          <span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a><span class="kw">begin</span></span>
          <span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> c   := TMyClass.create;</span>
          <span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> fn1 := make_non_owning(c,c.incr);</span>
          <span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> fn2 := make_non_owning(c,c.<span class="kw">read</span>);</span>
          <span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a></span>
          <span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>      c.incr;   c.<span class="kw">read</span>;</span>
          <span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>      c.incr;   c.<span class="kw">read</span>;</span>
          <span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>      fn1();</span>
          <span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>      fn2();</span>
          <span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>      <span class="co">//c.free;</span></span>
          <span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>      freeandnil(c);</span>
          <span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>      fn1();</span>
          <span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>      fn2();</span>
          <span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a></span>
          <span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>      readln;</span>
          <span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span>.</span>
          </code></pre></div></div>
          <blockquote>
          <p>Output :
          43
          44
          45
          dead call
          dead call</p>
          </blockquote>
          
          <p><a href="Non-owning-references.html">Non-owning References</a></p>


      <footer class="site-footer">
        
          <span class="site-footer-owner"><a href="https://github.com/pmcgee69/Memory-Safety-Experimental">Memory-Safety-Experimental</a> is maintained by <a href="https://github.com/pmcgee69">pmcgee69</a>.</span>
        
        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a>.</span>
      </footer>
    </main>
  </body>
</html>
